@model IEnumerable<MileageExpenseTracker.Models.MileageRate>
@{
    ViewData["Title"] = "Mileage Rate History";
}

<div class="container" style="max-width: 1200px; margin: 2rem auto; padding: 1.5rem;">
    <!-- Header Card -->
    <div style="
        background: white;
        padding: 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    ">
        <div>
            <h1 style="font-size: 1.5rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem;">
                Mileage Rate Management
            </h1>
            <p style="color: #6b7280; font-size: 0.875rem; margin: 0;">
                View rate history and update current mileage reimbursement rate.
            </p>
        </div>
        <a asp-action="Edit"
           style="
               padding: 0.625rem 1.25rem;
               background-color: #3b82f6;
               color: white;
               border: none;
               border-radius: 0.375rem;
               font-weight: 500;
               text-decoration: none;
               display: inline-flex;
               align-items: center;
               gap: 0.5rem;
           "
           onmouseover="this.style.backgroundColor='#2563eb'"
           onmouseout="this.style.backgroundColor='#3b82f6'">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z" />
            </svg>
            Update Rate
        </a>
    </div>

    <!-- Current Rate Card -->
    @{
        var currentRate = Model.FirstOrDefault(r => r.IsActive);
    }
    @if (currentRate != null)
    {
        <div style="
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            color: white;
            ">
            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">
                Current Rate
            </h2>
            <div style="display: flex; align-items: baseline; gap: 0.5rem;">
                <span style="font-size: 3rem; font-weight: 700;">$@currentRate.RatePerKm</span>
                <span style="font-size: 1.25rem; opacity: 0.9;">/km</span>
            </div>
            <p style="margin-top: 0.5rem; opacity: 0.9; font-size: 0.875rem;">
                Effective from @currentRate.EffectiveDate.ToString("MMMM dd, yyyy")
            </p>
        </div>
    }

    <!-- Table Card -->
    <div style="
        background: white;
        padding: 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    ">
        <h3 style="font-size: 1.125rem; font-weight: 600; color: #111827; margin-bottom: 1rem;">
            Rate History
        </h3>

        <table id="rateTable" class="table table-hover" style="width: 100%;">
            <thead style="background-color: #f9fafb; border-bottom: 2px solid #e5e7eb;">
                <tr>
                    <th style="padding: 0.75rem; font-weight: 600; color: #374151; font-size: 0.875rem;">
                        Rate (CAD)
                    </th>
                    <th style="padding: 0.75rem; font-weight: 600; color: #374151; font-size: 0.875rem;">
                        Effective Date
                    </th>
                    <th style="padding: 0.75rem; font-weight: 600; color: #374151; font-size: 0.875rem;">
                        Last Updated
                    </th>
                    <th style="padding: 0.75rem; font-weight: 600; color: #374151; font-size: 0.875rem;">
                        Updated By
                    </th>
                    <th style="padding: 0.75rem; font-weight: 600; color: #374151; font-size: 0.875rem; text-align: center;">
                        Status
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td style="padding: 0.75rem; color: #111827; font-weight: 600;">
                            $@item.RatePerKm/km
                        </td>
                        <td style="padding: 0.75rem; color: #111827;">
                            @item.EffectiveDate.ToString("MMM dd, yyyy")
                        </td>
                        <td style="padding: 0.75rem; color: #111827;">
                            @item.LastUpdated.ToString("MMM dd, yyyy HH:mm")
                        </td>
                        <td style="padding: 0.75rem; color: #111827;">
                            @(item.UpdatedBy ?? "System")
                        </td>
                        <td style="padding: 0.75rem; text-align: center;">
                            @if (item.IsActive)
                            {
                                <span style="
                                    padding: 0.25rem 0.75rem;
                                    background-color: #dcfce7;
                                    color: #166534;
                                    border-radius: 9999px;
                                    font-size: 0.75rem;
                                    font-weight: 500;
                                        ">Active</span>
                            }
                            else
                            {
                                <span style="
                                    padding: 0.25rem 0.75rem;
                                    background-color: #f3f4f6;
                                    color: #6b7280;
                                    border-radius: 9999px;
                                    font-size: 0.75rem;
                                    font-weight: 500;
                                        ">Inactive</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<style>
    /* DataTables custom styling */
    .dataTables_wrapper .dataTables_length select,
    .dataTables_wrapper .dataTables_filter input {
        padding: 0.375rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        font-size: 0.875rem;
    }

        .dataTables_wrapper .dataTables_filter input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter,
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_paginate {
        color: #374151;
        font-size: 0.875rem;
    }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 0.375rem 0.75rem;
            margin: 0 0.125rem;
            border-radius: 0.25rem;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151 !important;
        }

            .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
                background: #f9fafb !important;
                border-color: #3b82f6 !important;
                color: #3b82f6 !important;
            }

            .dataTables_wrapper .dataTables_paginate .paginate_button.current {
                background: #3b82f6 !important;
                border-color: #3b82f6 !important;
                color: white !important;
            }

    table.dataTable tbody tr:hover {
        background-color: #f9fafb;
    }
</style>

@section Scripts {
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#rateTable').DataTable({
                "pageLength": 10,
                "ordering": true,
                "order": [[2, "desc"]], // Sort by Last Updated date
                "searching": true,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
            });
        });
    </script>

    @if (TempData["SuccessMessage"] != null)
    {
        <script>
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: '@TempData["SuccessMessage"]',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true
            });
        </script>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <script>
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: '@TempData["ErrorMessage"]',
                confirmButtonColor: '#3b82f6'
            });
        </script>
    }
}